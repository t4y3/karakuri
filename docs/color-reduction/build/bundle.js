var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function i(t){t.forEach(e)}function r(t){return"function"==typeof t}function s(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function a(e,...n){if(null==e)return t;const i=e.subscribe(...n);return i.unsubscribe?()=>i.unsubscribe():i}function o(t){let e;return a(t,(t=>e=t))(),e}function l(t,e,n){t.$$.on_destroy.push(a(e,n))}function c(t,e,n=e){return t.set(n),e}function u(t,e){t.appendChild(e)}function h(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode.removeChild(t)}function p(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function g(t){return document.createElement(t)}function m(t){return document.createTextNode(t)}function f(){return m(" ")}function b(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function x(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function v(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function E(t,e,n){t.classList[n?"add":"remove"](e)}let y;function _(t){y=t}function T(t){(function(){if(!y)throw new Error("Function called outside component initialization");return y})().$$.on_mount.push(t)}const w=[],A=[],R=[],M=[],k=Promise.resolve();let P=!1;function L(t){R.push(t)}let $=!1;const B=new Set;function C(){if(!$){$=!0;do{for(let t=0;t<w.length;t+=1){const e=w[t];_(e),S(e.$$)}for(_(null),w.length=0;A.length;)A.pop()();for(let t=0;t<R.length;t+=1){const e=R[t];B.has(e)||(B.add(e),e())}R.length=0}while(w.length);for(;M.length;)M.pop()();P=!1,$=!1,B.clear()}}function S(t){if(null!==t.fragment){t.update(),i(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(L)}}const U=new Set;let I;function D(t,e){t&&t.i&&(U.delete(t),t.i(e))}function F(t,e,n,i){if(t&&t.o){if(U.has(t))return;U.add(t),I.c.push((()=>{U.delete(t),i&&(n&&t.d(1),i())})),t.o(e)}}function N(t){t&&t.c()}function X(t,n,s){const{fragment:a,on_mount:o,on_destroy:l,after_update:c}=t.$$;a&&a.m(n,s),L((()=>{const n=o.map(e).filter(r);l?l.push(...n):i(n),t.$$.on_mount=[]})),c.forEach(L)}function O(t,e){const n=t.$$;null!==n.fragment&&(i(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function q(t,e){-1===t.$$.dirty[0]&&(w.push(t),P||(P=!0,k.then(C)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function V(e,r,s,a,o,l,c=[-1]){const u=y;_(e);const h=e.$$={fragment:null,ctx:null,props:l,update:t,not_equal:o,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:n(),dirty:c,skip_bound:!1};let p=!1;if(h.ctx=s?s(e,r.props||{},((t,n,...i)=>{const r=i.length?i[0]:n;return h.ctx&&o(h.ctx[t],h.ctx[t]=r)&&(!h.skip_bound&&h.bound[t]&&h.bound[t](r),p&&q(e,t)),n})):[],h.update(),p=!0,i(h.before_update),h.fragment=!!a&&a(h.ctx),r.target){if(r.hydrate){const t=function(t){return Array.from(t.childNodes)}(r.target);h.fragment&&h.fragment.l(t),t.forEach(d)}else h.fragment&&h.fragment.c();r.intro&&D(e.$$.fragment),X(e,r.target,r.anchor),C()}_(u)}class j{$destroy(){O(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const G=[];function H(e,n=t){let i;const r=[];function a(t){if(s(e,t)&&(e=t,i)){const t=!G.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),G.push(n,e)}if(t){for(let t=0;t<G.length;t+=2)G[t][0](G[t+1]);G.length=0}}}return{set:a,update:function(t){a(t(e))},subscribe:function(s,o=t){const l=[s,o];return r.push(l),1===r.length&&(i=n(a)||t),s(e),()=>{const t=r.indexOf(l);-1!==t&&r.splice(t,1),0===r.length&&(i(),i=null)}}}}const z={file:null};const Y=function(){const{subscribe:t,set:e,update:n}=H(z);return{subscribe:t,reset:()=>e(z),set:t=>e(t)}}(),W={steps:[{title:"Sampling",list:["Sampling the original image for color statistics."]},{title:"Splitting",list:["Put all the pixels of the image (that is, their RGB values) in a bucket.","Find out which color channel (red, green, or blue) among the pixels in the bucket has the greatest range, then sort the pixels according to that channel's values.","After the bucket has been sorted, move the upper half of the pixels into a new bucket."]},{title:"Calculate the average color",list:["Average the pixels in each bucket and you have a palette of 16 colors."]},{title:"Mapping",list:["Mapping the colors to their representative in the color map."]}],current:0};const Z=function(){const{subscribe:t,set:e,update:n}=H(W);return{subscribe:t,reset:()=>e(W),update:t=>e(Object.assign(Object.assign({},W),{current:t})),set:t=>e(t)}}();function J(t,e,n){const i=t.slice();return i[1]=e[n],i[3]=n,i}function K(t,e,n){const i=t.slice();return i[4]=e[n],i[6]=n,i}function Q(t){let e;return{c(){e=g("div"),x(e,"class","-ml-px absolute mt-0.5 top-4 left-4 w-0.5 h-full bg-gray-600"),x(e,"aria-hidden","true")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function tt(t){let e;return{c(){e=g("span"),e.innerHTML='<span class="relative z-10 w-8 h-8 flex items-center justify-center bg-gray-600 rounded-full group-hover:bg-gray-800"><svg class="w-5 h-5 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg></span>',x(e,"class","h-9 flex items-center")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function et(t){let e;return{c(){e=g("span"),e.innerHTML='<span class="relative z-10 w-8 h-8 flex items-center justify-center bg-white border-2 border-gray-600 rounded-full"><span class="h-2.5 w-2.5 bg-gray-600 rounded-full"></span></span>',x(e,"class","h-9 flex items-center"),x(e,"aria-hidden","true")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function nt(t){let e;return{c(){e=g("span"),e.innerHTML='<span class="relative z-10 w-8 h-8 flex items-center justify-center bg-white border-2 border-gray-300 rounded-full group-hover:border-gray-400"><span class="h-2.5 w-2.5 bg-transparent rounded-full group-hover:bg-gray-300"></span></span>',x(e,"class","h-9 flex items-center"),x(e,"aria-hidden","true")},m(t,n){h(t,e,n)},d(t){t&&d(e)}}}function it(t){let e,n,i=t[4]+"";return{c(){e=g("span"),n=m(i),x(e,"class","text-sm text-gray-500")},m(t,i){h(t,e,i),u(e,n)},p(t,e){1&e&&i!==(i=t[4]+"")&&v(n,i)},d(t){t&&d(e)}}}function rt(t){let e,n,i,r,s,a,o,l,c,b,y,_=t[1].title+"",T=t[3]<t[0].steps.length-1&&Q(),w=t[3]<t[0].current&&tt(),A=t[3]===t[0].current&&et(),R=t[0].current<t[3]&&nt(),M=t[1].list,k=[];for(let e=0;e<M.length;e+=1)k[e]=it(K(t,M,e));return{c(){e=g("li"),T&&T.c(),n=f(),i=g("div"),w&&w.c(),r=f(),A&&A.c(),s=f(),R&&R.c(),a=f(),o=g("span"),l=g("span"),c=m(_),b=f();for(let t=0;t<k.length;t+=1)k[t].c();y=f(),x(l,"class","text-xs font-semibold uppercase tracking-wide text-gray-300"),x(o,"class","ml-4 min-w-0 flex flex-col space-y-1"),x(i,"class","relative flex items-start group"),x(e,"class","relative pb-10"),E(e,"pb-10",t[3]<t[0].steps.length-1)},m(t,d){h(t,e,d),T&&T.m(e,null),u(e,n),u(e,i),w&&w.m(i,null),u(i,r),A&&A.m(i,null),u(i,s),R&&R.m(i,null),u(i,a),u(i,o),u(o,l),u(l,c),u(o,b);for(let t=0;t<k.length;t+=1)k[t].m(o,null);u(e,y)},p(t,l){if(t[3]<t[0].steps.length-1?T||(T=Q(),T.c(),T.m(e,n)):T&&(T.d(1),T=null),t[3]<t[0].current?w||(w=tt(),w.c(),w.m(i,r)):w&&(w.d(1),w=null),t[3]===t[0].current?A||(A=et(),A.c(),A.m(i,s)):A&&(A.d(1),A=null),t[0].current<t[3]?R||(R=nt(),R.c(),R.m(i,a)):R&&(R.d(1),R=null),1&l&&_!==(_=t[1].title+"")&&v(c,_),1&l){let e;for(M=t[1].list,e=0;e<M.length;e+=1){const n=K(t,M,e);k[e]?k[e].p(n,l):(k[e]=it(n),k[e].c(),k[e].m(o,null))}for(;e<k.length;e+=1)k[e].d(1);k.length=M.length}1&l&&E(e,"pb-10",t[3]<t[0].steps.length-1)},d(t){t&&d(e),T&&T.d(),w&&w.d(),A&&A.d(),R&&R.d(),p(k,t)}}}function st(e){let n,i,r=e[0].steps,s=[];for(let t=0;t<r.length;t+=1)s[t]=rt(J(e,r,t));return{c(){n=g("nav"),i=g("ol");for(let t=0;t<s.length;t+=1)s[t].c();x(i,"class","overflow-hidden"),x(n,"aria-label","Progress"),x(n,"class","max-w-sm")},m(t,e){h(t,n,e),u(n,i);for(let t=0;t<s.length;t+=1)s[t].m(i,null)},p(t,[e]){if(1&e){let n;for(r=t[0].steps,n=0;n<r.length;n+=1){const a=J(t,r,n);s[n]?s[n].p(a,e):(s[n]=rt(a),s[n].c(),s[n].m(i,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=r.length}},i:t,o:t,d(t){t&&d(n),p(s,t)}}}function at(t,e,n){let i;return l(t,Z,(t=>n(0,i=t))),[i]}class ot extends j{constructor(t){super(),V(this,t,at,st,s,{})}}class lt{static loadFile(t){return new Promise(((e,n)=>{fetch(t).then((t=>t.text())).then((t=>{e(t)})).catch((t=>{n(t)}))}))}set width(t){this.canvas.width=t}get width(){return this.canvas.width}set height(t){this.canvas.height=t}get height(){return this.canvas.height}set program(t){this.gl.useProgram(t),this.currentProgram=t}get program(){return this.currentProgram}constructor(){this.canvas=null,this.gl=null,this.currentProgram=null}initialize(t,e){if(this.canvas=t,this.gl=this.canvas.getContext("webgl"+(!0===e?"2":"")),null==this.gl)throw new Error("webgl not supported")}createShaderObject(t,e){const n=this.gl,i=n.createShader(e);if(n.shaderSource(i,t),n.compileShader(i),n.getShaderParameter(i,n.COMPILE_STATUS))return i;throw new Error(n.getShaderInfoLog(i))}createProgramObject(t,e){const n=this.gl,i=n.createProgram();if(n.attachShader(i,t),n.attachShader(i,e),n.linkProgram(i),n.deleteShader(t),n.deleteShader(e),n.getProgramParameter(i,n.LINK_STATUS))return n.useProgram(i),i;throw new Error(n.getProgramInfoLog(i))}createProgramObjectTF(t,e,n){const i=this.gl,r=i.createProgram();if(i.attachShader(r,t),i.attachShader(r,e),i.transformFeedbackVaryings(r,n,i.SEPARATE_ATTRIBS),i.linkProgram(r),i.deleteShader(t),i.deleteShader(e),i.getProgramParameter(r,i.LINK_STATUS))return i.useProgram(r),r;throw new Error(i.getProgramInfoLog(r))}createVBO(t){const e=this.gl,n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),n}createIBO(t){const e=this.gl,n=e.createBuffer();return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Int16Array(t),e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),n}enableAttribute(t,e,n){const i=this.gl;t.forEach(((t,r)=>{i.bindBuffer(i.ARRAY_BUFFER,t),i.enableVertexAttribArray(e[r]),i.vertexAttribPointer(e[r],n[r],i.FLOAT,!1,0,0)}))}createTexture(t,e){const n=this.gl,i=n.createTexture();return n.activeTexture(e),n.bindTexture(n.TEXTURE_2D,i),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t),n.generateMipmap(n.TEXTURE_2D),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),i}createCubeTextureFromFile(t,e){return new Promise((n=>{const i=this.gl,r=i.createTexture();i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_CUBE_MAP,r);const s=t.map(((t,n)=>new Promise((r=>{const s=new Image;s.addEventListener("load",(()=>{i.texImage2D(e[n],0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,s),r()}),!1),s.src=t}))));Promise.all(s).then((()=>{i.generateMipmap(i.TEXTURE_CUBE_MAP),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindTexture(i.TEXTURE_CUBE_MAP,null),n(r)}))}))}createFramebuffer(t,e){const n=this.gl,i=n.createFramebuffer(),r=n.createRenderbuffer(),s=n.createTexture();return n.bindFramebuffer(n.FRAMEBUFFER,i),n.bindRenderbuffer(n.RENDERBUFFER,r),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,t,e),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,r),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0),n.bindTexture(n.TEXTURE_2D,null),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null),{framebuffer:i,depthRenderbuffer:r,texture:s}}}class ct{static get DEFAULT_DISTANCE(){return 5}static get DEFAULT_MIN_DISTANCE(){return 1}static get DEFAULT_MAX_DISTANCE(){return 10}static get DEFAULT_MOVE_SCALE(){return 2}constructor(t,e={}){this.target=t,this.distance=e.distance||ct.DEFAULT_DISTANCE,this.minDistance=e.min||ct.DEFAULT_MIN_DISTANCE,this.maxDistance=e.max||ct.DEFAULT_MAX_DISTANCE,this.moveScale=e.move||ct.DEFAULT_MOVE_SCALE,this.position=[0,0,this.distance],this.center=[0,0,0],this.upDirection=[0,1,0],this.moveX=[1,0,0],this.moveZ=[0,0,1],this.defaultPosition=[0,0,this.distance],this.defaultCenter=[0,0,0],this.defaultUpDirection=[0,1,0],this.defaultMoveX=[1,0,0],this.defaultMoveZ=[0,0,1],this.movePosition=[0,0,0],this.rotateX=0,this.rotateY=0,this.scale=0,this.isDown=!1,this.prevPosition=[0,0],this.offsetPosition=[0,0],this.qt=gt.create(),this.qtx=gt.create(),this.qty=gt.create(),this.mouseInteractionStart=this.mouseInteractionStart.bind(this),this.mouseInteractionMove=this.mouseInteractionMove.bind(this),this.mouseInteractionEnd=this.mouseInteractionEnd.bind(this),this.wheelScroll=this.wheelScroll.bind(this),this.target.addEventListener("mousedown",this.mouseInteractionStart,!1),this.target.addEventListener("mousemove",this.mouseInteractionMove,!1),this.target.addEventListener("mouseup",this.mouseInteractionEnd,!1),this.target.addEventListener("contextmenu",(t=>{t.preventDefault()}),!1)}mouseInteractionStart(t){this.isDown=!0;const e=this.target.getBoundingClientRect();this.prevPosition=[t.clientX-e.left,t.clientY-e.top]}mouseInteractionMove(t){if(!0!==this.isDown)return;const e=this.target.getBoundingClientRect(),n=e.width,i=e.height,r=t.clientX-e.left,s=t.clientY-e.top,a=1/Math.min(n,i);switch(this.offsetPosition=[r-this.prevPosition[0],s-this.prevPosition[1]],this.prevPosition=[r,s],t.buttons){case 1:this.rotateX+=this.offsetPosition[0]*a,this.rotateY+=this.offsetPosition[1]*a,this.rotateX=this.rotateX%1,this.rotateY=Math.min(Math.max(this.rotateY%1,-.25),.25);break;case 2:const t=2*Math.PI,e=this.offsetPosition[0]*a*this.moveScale,n=this.offsetPosition[1]*a*this.moveScale,i=this.defaultMoveX.slice(),r=this.defaultMoveZ.slice(),s=gt.identity(gt.create());gt.rotate(this.rotateX*t,[0,1,0],s),gt.toVecIII(i,s,this.moveX),gt.toVecIII(r,s,this.moveZ),this.movePosition[0]-=this.moveX[0]*e+this.moveZ[0]*n,this.movePosition[2]-=this.moveX[2]*e+this.moveZ[2]*n}}mouseInteractionEnd(t){this.isDown=!1}wheelScroll(t){const e=t.wheelDelta;e>0?this.scale=-.5:e<0&&(this.scale=.5)}update(){const t=2*Math.PI,e=[1,0,0];return this.scale*=.7,this.distance+=this.scale,this.distance=Math.min(Math.max(this.distance,this.minDistance),this.maxDistance),this.defaultPosition[2]=this.distance,gt.identity(this.qt),gt.identity(this.qtx),gt.identity(this.qty),gt.rotate(this.rotateX*t,[0,1,0],this.qtx),gt.toVecIII(e,this.qtx,e),gt.rotate(this.rotateY*t,e,this.qty),gt.multiply(this.qtx,this.qty,this.qt),gt.toVecIII(this.defaultPosition,this.qt,this.position),gt.toVecIII(this.defaultUpDirection,this.qt,this.upDirection),this.position[0]+=this.movePosition[0],this.position[1]+=this.movePosition[1],this.position[2]+=this.movePosition[2],this.center[0]=this.defaultCenter[0]+this.movePosition[0],this.center[1]=this.defaultCenter[1]+this.movePosition[1],this.center[2]=this.defaultCenter[2]+this.movePosition[2],ht.lookAt(this.position,this.center,this.upDirection)}}class ut{static get mat4(){return ht}static get vec3(){return dt}static get vec2(){return pt}static get qtn(){return gt}}class ht{static create(){return new Float32Array(16)}static identity(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}static multiply(t,e,n){let i=n;null==n&&(i=ht.create());let r=t[0],s=t[1],a=t[2],o=t[3],l=t[4],c=t[5],u=t[6],h=t[7],d=t[8],p=t[9],g=t[10],m=t[11],f=t[12],b=t[13],x=t[14],v=t[15],E=e[0],y=e[1],_=e[2],T=e[3],w=e[4],A=e[5],R=e[6],M=e[7],k=e[8],P=e[9],L=e[10],$=e[11],B=e[12],C=e[13],S=e[14],U=e[15];return i[0]=E*r+y*l+_*d+T*f,i[1]=E*s+y*c+_*p+T*b,i[2]=E*a+y*u+_*g+T*x,i[3]=E*o+y*h+_*m+T*v,i[4]=w*r+A*l+R*d+M*f,i[5]=w*s+A*c+R*p+M*b,i[6]=w*a+A*u+R*g+M*x,i[7]=w*o+A*h+R*m+M*v,i[8]=k*r+P*l+L*d+$*f,i[9]=k*s+P*c+L*p+$*b,i[10]=k*a+P*u+L*g+$*x,i[11]=k*o+P*h+L*m+$*v,i[12]=B*r+C*l+S*d+U*f,i[13]=B*s+C*c+S*p+U*b,i[14]=B*a+C*u+S*g+U*x,i[15]=B*o+C*h+S*m+U*v,i}static scale(t,e,n){let i=n;return null==n&&(i=ht.create()),i[0]=t[0]*e[0],i[1]=t[1]*e[0],i[2]=t[2]*e[0],i[3]=t[3]*e[0],i[4]=t[4]*e[1],i[5]=t[5]*e[1],i[6]=t[6]*e[1],i[7]=t[7]*e[1],i[8]=t[8]*e[2],i[9]=t[9]*e[2],i[10]=t[10]*e[2],i[11]=t[11]*e[2],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}static translate(t,e,n){let i=n;return null==n&&(i=ht.create()),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12],i[13]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13],i[14]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14],i[15]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15],i}static rotate(t,e,n,i){let r=i;null==i&&(r=ht.create());let s=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);if(!s)return null;let a=n[0],o=n[1],l=n[2];1!=s&&(s=1/s,a*=s,o*=s,l*=s);let c=Math.sin(e),u=Math.cos(e),h=1-u,d=t[0],p=t[1],g=t[2],m=t[3],f=t[4],b=t[5],x=t[6],v=t[7],E=t[8],y=t[9],_=t[10],T=t[11],w=a*a*h+u,A=o*a*h+l*c,R=l*a*h-o*c,M=a*o*h-l*c,k=o*o*h+u,P=l*o*h+a*c,L=a*l*h+o*c,$=o*l*h-a*c,B=l*l*h+u;return e?t!=r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]):r=t,r[0]=d*w+f*A+E*R,r[1]=p*w+b*A+y*R,r[2]=g*w+x*A+_*R,r[3]=m*w+v*A+T*R,r[4]=d*M+f*k+E*P,r[5]=p*M+b*k+y*P,r[6]=g*M+x*k+_*P,r[7]=m*M+v*k+T*P,r[8]=d*L+f*$+E*B,r[9]=p*L+b*$+y*B,r[10]=g*L+x*$+_*B,r[11]=m*L+v*$+T*B,r}static lookAt(t,e,n,i){let r=t[0],s=t[1],a=t[2],o=e[0],l=e[1],c=e[2],u=n[0],h=n[1],d=n[2];if(r==o&&s==l&&a==c)return ht.identity(i);let p,g,m,f,b,x,v,E,y,_,T=i;return null==i&&(T=ht.create()),v=r-e[0],E=s-e[1],y=a-e[2],_=1/Math.sqrt(v*v+E*E+y*y),v*=_,E*=_,y*=_,p=h*y-d*E,g=d*v-u*y,m=u*E-h*v,_=Math.sqrt(p*p+g*g+m*m),_?(_=1/_,p*=_,g*=_,m*=_):(p=0,g=0,m=0),f=E*m-y*g,b=y*p-v*m,x=v*g-E*p,_=Math.sqrt(f*f+b*b+x*x),_?(_=1/_,f*=_,b*=_,x*=_):(f=0,b=0,x=0),T[0]=p,T[1]=f,T[2]=v,T[3]=0,T[4]=g,T[5]=b,T[6]=E,T[7]=0,T[8]=m,T[9]=x,T[10]=y,T[11]=0,T[12]=-(p*r+g*s+m*a),T[13]=-(f*r+b*s+x*a),T[14]=-(v*r+E*s+y*a),T[15]=1,T}static perspective(t,e,n,i,r){let s=r;null==r&&(s=ht.create());let a=n*Math.tan(t*Math.PI/360),o=2*(a*e),l=2*a,c=i-n;return s[0]=2*n/o,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*n/l,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-(i+n)/c,s[11]=-1,s[12]=0,s[13]=0,s[14]=-i*n*2/c,s[15]=0,s}static ortho(t,e,n,i,r,s,a){let o=a;null==a&&(o=ht.create());let l=e-t,c=n-i,u=s-r;return o[0]=2/l,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/c,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/u,o[11]=0,o[12]=-(t+e)/l,o[13]=-(n+i)/c,o[14]=-(s+r)/u,o[15]=1,o}static transpose(t,e){let n=e;return null==e&&(n=ht.create()),n[0]=t[0],n[1]=t[4],n[2]=t[8],n[3]=t[12],n[4]=t[1],n[5]=t[5],n[6]=t[9],n[7]=t[13],n[8]=t[2],n[9]=t[6],n[10]=t[10],n[11]=t[14],n[12]=t[3],n[13]=t[7],n[14]=t[11],n[15]=t[15],n}static inverse(t,e){let n=e;null==e&&(n=ht.create());let i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],g=t[11],m=t[12],f=t[13],b=t[14],x=t[15],v=i*l-r*o,E=i*c-s*o,y=i*u-a*o,_=r*c-s*l,T=r*u-a*l,w=s*u-a*c,A=h*f-d*m,R=h*b-p*m,M=h*x-g*m,k=d*b-p*f,P=d*x-g*f,L=p*x-g*b,$=1/(v*L-E*P+y*k+_*M-T*R+w*A);return n[0]=(l*L-c*P+u*k)*$,n[1]=(-r*L+s*P-a*k)*$,n[2]=(f*w-b*T+x*_)*$,n[3]=(-d*w+p*T-g*_)*$,n[4]=(-o*L+c*M-u*R)*$,n[5]=(i*L-s*M+a*R)*$,n[6]=(-m*w+b*y-x*E)*$,n[7]=(h*w-p*y+g*E)*$,n[8]=(o*P-l*M+u*A)*$,n[9]=(-i*P+r*M-a*A)*$,n[10]=(m*T-f*y+x*v)*$,n[11]=(-h*T+d*y-g*v)*$,n[12]=(-o*k+l*R-c*A)*$,n[13]=(i*k-r*R+s*A)*$,n[14]=(-m*_+f*E-b*v)*$,n[15]=(h*_-d*E+p*v)*$,n}static toVecIV(t,e){let n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],g=t[12],m=t[13],f=t[14],b=t[15],x=e[0],v=e[1],E=e[2],y=e[3],_=[];return _[0]=x*n+v*a+E*u+y*g,_[1]=x*i+v*o+E*h+y*m,_[2]=x*r+v*l+E*d+y*f,_[3]=x*s+v*c+E*p+y*b,e=_,_}static vpFromCameraProperty(t,e,n,i,r,s,a,o,l,c){ht.lookAt(t,e,n,o),ht.perspective(i,r,s,a,l),ht.multiply(l,o,c)}static screenPositionFromMvp(t,e,n,i){let r=.5*n,s=.5*i,a=ht.toVecIV(t,[e[0],e[1],e[2],1]);return a[3]<=0?[NaN,NaN]:(a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],[r+a[0]*r,s-a[1]*s])}}class dt{static create(){return new Float32Array(3)}static len(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}static distance(t,e){let n=dt.create();return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}static normalize(t){let e=dt.create(),n=dt.len(t);if(n>0){let i=1/n;e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}else e[0]=0,e[1]=0,e[2]=0;return e}static dot(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}static cross(t,e){let n=dt.create();return n[0]=t[1]*e[2]-t[2]*e[1],n[1]=t[2]*e[0]-t[0]*e[2],n[2]=t[0]*e[1]-t[1]*e[0],n}static faceNormal(t,e,n){let i=dt.create(),r=[e[0]-t[0],e[1]-t[1],e[2]-t[2]],s=[n[0]-t[0],n[1]-t[1],n[2]-t[2]];return i[0]=r[1]*s[2]-r[2]*s[1],i[1]=r[2]*s[0]-r[0]*s[2],i[2]=r[0]*s[1]-r[1]*s[0],dt.normalize(i)}}class pt{static create(){return new Float32Array(2)}static len(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}static distance(t,e){let n=pt.create();return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}static normalize(t){let e=pt.create(),n=pt.len(t);if(n>0){let i=1/n;e[0]=t[0]*i,e[1]=t[1]*i}return e}static dot(t,e){return t[0]*e[0]+t[1]*e[1]}static cross(t,e){return pt.create(),t[0]*e[1]-t[1]*e[0]}}class gt{static create(){return new Float32Array(4)}static identity(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}static inverse(t,e){let n=e;return null==e&&(n=gt.create()),n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=t[3],n}static normalize(t){let e=t[0],n=t[1],i=t[2],r=Math.sqrt(e*e+n*n+i*i);return 0===r?(t[0]=0,t[1]=0,t[2]=0):(r=1/r,t[0]=e*r,t[1]=n*r,t[2]=i*r),t}static multiply(t,e,n){let i=n;null==n&&(i=gt.create());let r=t[0],s=t[1],a=t[2],o=t[3],l=e[0],c=e[1],u=e[2],h=e[3];return i[0]=r*h+o*l+s*u-a*c,i[1]=s*h+o*c+a*l-r*u,i[2]=a*h+o*u+r*c-s*l,i[3]=o*h-r*l-s*c-a*u,i}static rotate(t,e,n){let i=n;null==n&&(i=gt.create());let r=e[0],s=e[1],a=e[2],o=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);if(0!==o){let t=1/o;r*=t,s*=t,a*=t}let l=Math.sin(.5*t);return i[0]=r*l,i[1]=s*l,i[2]=a*l,i[3]=Math.cos(.5*t),i}static toVecIII(t,e,n){let i=n;null==n&&(i=[0,0,0]);let r=gt.create(),s=gt.create(),a=gt.create();return gt.inverse(e,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],gt.multiply(a,r,s),gt.multiply(s,e,a),i[0]=a[0],i[1]=a[1],i[2]=a[2],i}static toMatIV(t,e){let n=e;null==e&&(n=ht.create());let i=t[0],r=t[1],s=t[2],a=t[3],o=i+i,l=r+r,c=s+s,u=i*o,h=i*l,d=i*c,p=r*l,g=r*c,m=s*c,f=a*o,b=a*l,x=a*c;return n[0]=1-(p+m),n[1]=h-x,n[2]=d+b,n[3]=0,n[4]=h+x,n[5]=1-(u+m),n[6]=g-f,n[7]=0,n[8]=d-b,n[9]=g+f,n[10]=1-(u+p),n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}static slerp(t,e,n,i){let r=i;null==i&&(r=gt.create());let s=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],a=1-s*s;if(a<=0)r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3];else if(a=Math.sqrt(a),Math.abs(a)<1e-4)r[0]=.5*t[0]+.5*e[0],r[1]=.5*t[1]+.5*e[1],r[2]=.5*t[2]+.5*e[2],r[3]=.5*t[3]+.5*e[3];else{let i=Math.acos(s),o=i*n,l=Math.sin(i-o)/a,c=Math.sin(o)/a;r[0]=t[0]*l+e[0]*c,r[1]=t[1]*l+e[1]*c,r[2]=t[2]*l+e[2]*c,r[3]=t[3]*l+e[3]*c}return r}}class mt{static plane(t,e,n){let i,r;i=t/2,r=e/2;return{position:[-i,r,0,i,r,0,-i,-r,0,i,-r,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],color:[n[0],n[1],n[2],n[3],n[0],n[1],n[2],n[3],n[0],n[1],n[2],n[3],n[0],n[1],n[2],n[3]],texCoord:[0,0,1,0,0,1,1,1],index:[0,2,1,1,2,3]}}static circle(t,e,n){let i,r=0,s=[],a=[],o=[],l=[],c=[];for(s.push(0,0,0),a.push(0,0,1),o.push(n[0],n[1],n[2],n[3]),l.push(.5,.5),i=0;i<t;i++){let u=2*Math.PI/t*i,h=Math.cos(u),d=Math.sin(u);s.push(h*e,d*e,0),a.push(0,0,1),o.push(n[0],n[1],n[2],n[3]),l.push(.5*(h+1),1-.5*(d+1)),i===t-1?c.push(0,r+1,1):c.push(0,r+1,r+2),++r}return{position:s,normal:a,color:o,texCoord:l,index:c}}static cube(t,e){let n=.5*t,i=[-n,-n,n,n,-n,n,n,n,n,-n,n,n,-n,-n,-n,-n,n,-n,n,n,-n,n,-n,-n,-n,n,-n,-n,n,n,n,n,n,n,n,-n,-n,-n,-n,n,-n,-n,n,-n,n,-n,-n,n,n,-n,-n,n,n,-n,n,n,n,n,-n,n,-n,-n,-n,-n,-n,n,-n,n,n,-n,n,-n],r=1/Math.sqrt(3),s=[-r,-r,r,r,-r,r,r,r,r,-r,r,r,-r,-r,-r,-r,r,-r,r,r,-r,r,-r,-r,-r,r,-r,-r,r,r,r,r,r,r,r,-r,-r,-r,-r,r,-r,-r,r,-r,r,-r,-r,r,r,-r,-r,r,r,-r,r,r,r,r,-r,r,-r,-r,-r,-r,-r,r,-r,r,r,-r,r,-r],a=[];for(let t=0;t<i.length/3;t++)a.push(e[0],e[1],e[2],e[3]);return{position:i,normal:s,color:a,texCoord:[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],index:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}static box(t,e,n,i){let r=.5*t,s=.5*e,a=.5*n,o=[-r,-s,a,r,-s,a,r,s,a,-r,s,a,-r,-s,-a,-r,s,-a,r,s,-a,r,-s,-a,-r,s,-a,-r,s,a,r,s,a,r,s,-a,-r,-s,-a,r,-s,-a,r,-s,a,-r,-s,a,r,-s,-a,r,s,-a,r,s,a,r,-s,a,-r,-s,-a,-r,-s,a,-r,s,a,-r,s,-a],l=1/Math.sqrt(3),c=[-l,-l,l,l,-l,l,l,l,l,-l,l,l,-l,-l,-l,-l,l,-l,l,l,-l,l,-l,-l,-l,l,-l,-l,l,l,l,l,l,l,l,-l,-l,-l,-l,l,-l,-l,l,-l,l,-l,-l,l,l,-l,-l,l,l,-l,l,l,l,l,-l,l,-l,-l,-l,-l,-l,l,-l,l,l,-l,l,-l],u=[];for(let t=0;t<o.length/3;t++)u.push(i[0],i[1],i[2],i[3]);return{position:o,normal:c,color:u,texCoord:[0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1],index:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}}static boxLine(t,e,n,i){let r=.5*t,s=.5*e,a=.5*n,o=[-r,-s,a,r,-s,a,r,-s,a,r,s,a,r,s,a,-r,s,a,-r,s,a,-r,-s,a,-r,-s,-a,-r,s,-a,-r,s,-a,r,s,-a,r,s,-a,r,-s,-a,r,-s,-a,-r,-s,-a,-r,s,-a,-r,s,a,-r,s,a,r,s,a,r,s,a,r,s,-a,r,s,-a,-r,s,-a,-r,-s,-a,r,-s,-a,r,-s,-a,r,-s,a,r,-s,a,-r,-s,a,-r,-s,a,-r,-s,-a,r,-s,-a,r,s,-a,r,s,-a,r,s,a,r,s,a,r,-s,a,r,-s,a,r,-s,-a,-r,-s,-a,-r,-s,a,-r,-s,a,-r,s,a,-r,s,a,-r,s,-a],l=[];for(let t=0;t<o.length/3;t++)l.push(i[0],i[1],i[2],i[3]);return{position:o,color:l}}static axis(t,e){return{position:[-1*t,0,0,t,0,0,0,-1*t,0,0,t,0,0,0,t,0,0,-1*t],color:[.45,.45,.45,1,.45,.45,.45,1,.45,.45,.45,1,.45,.45,.45,1,.45,.45,.45,1,.45,.45,.45,1]}}}var ft;!function(t){t[t.R=0]="R",t[t.G=1]="G",t[t.B=2]="B"}(ft||(ft={}));var bt=function(t,e){this.imageData=t,this.options=e||{strict:!1},this.colors=this.__calculateColorCount(this.imageData.data),this.buckets=[],this.__bucketsPerStep=[]},xt={roundingBits:{configurable:!0},palette:{configurable:!0},bucketsPerStep:{configurable:!0}};bt.averageColor=function(t){for(var e=0,n=0,i=0,r=0,s=0,a=t.length;s<a;s=s+1|0){var o=t[s],l=o[0],c=o[1],u=o[2],h=o[3];n=l*h+n,i=c*h+i,r=u*h+r,e=e+h|0}return[Math.round(n/e),Math.round(i/e),Math.round(r/e)]},xt.roundingBits.get=function(){return this.options.strict?255:248},xt.palette.get=function(){for(var t=[],e=0,n=this.buckets.length;e<n;e=e+1|0)t[e]=bt.averageColor(this.buckets[e].colors);return t},xt.bucketsPerStep.get=function(){return this.__bucketsPerStep},bt.prototype.reduce=function(t){if(this.colors.length<=t)return console.warn("It has already been reduced color."),this.imageData;this.buckets=this.__mediancut([this.__generateBucket(this.colors)],t);for(var e=new Map,n=0,i=this.buckets.length;n<i;n=n+1|0)for(var r=this.buckets[n],s=bt.averageColor(r.colors),a=0,o=r.colors.length;a<o;a=a+1|0){var l=r.colors[a],c=l[0],u=l[1],h=l[2],d=c&this.roundingBits|(u&this.roundingBits)<<8|(h&this.roundingBits)<<16;e.set(d,s)}for(var p=this.imageData.data,g=p.length,m=new Uint8ClampedArray(g),f=0;f<g;){var b=p[f]&this.roundingBits|(p[f+1]&this.roundingBits)<<8|(p[f+2]&this.roundingBits)<<16,x=e.get(b),v=x[0],E=x[1],y=x[2];m[f]=v,m[f+1]=E,m[f+2]=y,m[f+3]=p[f+3],f=f+4|0}return new ImageData(m,this.imageData.width,this.imageData.height)},bt.prototype.__calculateColorCount=function(t){for(var e=new Map,n=t.length,i=0;i<n;){var r=t[i]&this.roundingBits,s=t[i+1]&this.roundingBits,a=t[i+2]&this.roundingBits,o=r|s<<8|a<<16,l=e.get(o),c=l?l[3]+1:1;e.set(o,[r,s,a,c]),i=i+4|0}var u=[];return e.forEach((function(t){u[u.length]=t})),u},bt.prototype.__getTotalAnGreatestRangeChannel=function(t){for(var e=0,n=0,i=0,r=0,s=255,a=255,o=255,l=t.length,c=0;c<l;){var u=t[c],h=u[0],d=u[1],p=u[2],g=u[3];n=Math.max(h,n),i=Math.max(d,i),r=Math.max(p,r),s=Math.min(h,s),a=Math.min(d,a),o=Math.min(p,o),e+=g,c=c+1|0}var m=1.2*(n-s),f=1.2*(i-a),b=r-o,x=Math.max(m,f,b),v=ft.R;return m===x&&(v=ft.R),f===x&&(v=ft.G),b===x&&(v=ft.B),{total:e,channel:v,minR:s,minG:a,minB:o,maxR:n,maxG:i,maxB:r}},bt.prototype.__mediancut=function(t,e){this.__bucketsPerStep.push([].concat(t));var n=0,i=0;if(t.length+1>e)return t;for(var r=0,s=t.length;r<s;r=r+1|0)t[r].total>n&&1!==t[r].colors.length&&(i=r,n=t[r].total);var a=t[i];if(1===a.total||1===a.colors.length)return console.error("Cube could not be split."),t;var o=a.channel;a.colors.sort((function(t,e){return t[o]-e[o]}));var l=Math.floor((a.colors.length+1)/2),c=this.__generateBucket(a.colors.slice(0,l)),u=this.__generateBucket(a.colors.slice(l));return t.splice(i,1,c,u),this.__mediancut(t,e)},bt.prototype.__generateBucket=function(t){var e=this.__getTotalAnGreatestRangeChannel(t);return{colors:t,total:e.total,channel:e.channel,minR:e.minR,minG:e.minG,minB:e.minB,maxR:e.maxR,maxG:e.maxG,maxB:e.maxB}},Object.defineProperties(bt.prototype,xt);var vt=class extends HTMLElement{constructor(t,e,n=!0){super(),this.editing=!1,this.attachShadow({mode:"open"}),this.axes=t,this.totalTime=e,this.debug=n,this.shadowRoot.innerHTML=this.template(t,e),this.$pane=this.shadowRoot.querySelector("#pane"),this.$timeline=this.shadowRoot.querySelector("#timeline"),this.$current=this.shadowRoot.querySelector("#current"),this.$progress=this.shadowRoot.querySelector("#progress"),this.$labels=this.shadowRoot.querySelectorAll(".label"),this.$bars=this.shadowRoot.querySelectorAll(".bar"),this.$barsBegin=this.shadowRoot.querySelectorAll(".begin"),this.$barsEnd=this.shadowRoot.querySelectorAll(".end"),this.$previous=this.shadowRoot.querySelector("#previous"),this.$playPause=this.shadowRoot.querySelector("#play-pause"),this.$next=this.shadowRoot.querySelector("#next"),this.playing=!0,this.previous=!1,this.next=!1,this.skip=-1,this.$previous.addEventListener("click",(t=>{this.previous=!0})),this.$playPause.addEventListener("click",(t=>{this.playing=!this.playing})),this.$next.addEventListener("click",(t=>{this.next=!0}));for(let t=0,e=this.$bars.length;t<e;t++){if(this.$bars[t].addEventListener("click",(t=>{let e=t.currentTarget,n=Number(e.getAttribute("idx"));this.skip=n})),!this.debug)continue;let e=this.$barsBegin[t],n=this.$barsEnd[t];e.addEventListener("input",(n=>{let i=Number(e.value);if(Number(this.$barsEnd[t].value)<i)n.preventDefault();else if(Number.isFinite(this.axes[t].position))this.axes[t].position=i,this.axes[t].duration=this.axes[t].endAt-(this.axes[t].delay+this.axes[t].position);else{let e=this.axes.find((e=>e.key===this.axes[t].position));this.axes[t].delay=i-e.endAt,this.axes[t].duration=this.axes[t].endAt-(this.axes[t].delay+e.endAt)}})),n.addEventListener("input",(e=>{let i=Number(n.value);if(i<Number(this.$barsBegin[t].value))e.preventDefault();else if(Number.isFinite(this.axes[t].position))this.axes[t].duration=i-(this.axes[t].position+this.axes[t].delay);else{let e=this.axes.find((e=>e.key===this.axes[t].position));this.axes[t].duration=i-e.endAt-this.axes[t].delay}}))}this.$labels.forEach((t=>{t.addEventListener("click",(t=>{let e=t.currentTarget,n=Number(e.getAttribute("idx"));this.skip=n}))})),this.$current.addEventListener("input",(t=>{this.editing=!0;let e=Number(this.$current.value);this.__updateProgressPosition(e),this.__updateBar(this.totalTime)})),this.$current.addEventListener("change",(t=>{this.editing=!1}))}attributeChangedCallback(){}connectedCallback(){}disconnectedCallback(){}getAxes(){return this.axes}get(t){let e=Date.now(),n=Number(this.$current.value),i=e-t;if(this.playing||(t=e-n,i=n),this.editing&&(t=e-n,i=n),-1<this.skip){let n=this.axes[this.skip];t=e-n.beginAt,i=n.beginAt,this.skip=-1}return this.previous&&(this.previous=!1,t=e,i=0),this.next&&(this.next=!1,t=e-this.totalTime,i=this.totalTime),{beginAt:t,elapsedTime:i,editing:this.editing}}update(t,e,n){this.axes=n,this.totalTime=e,this.$current.setAttribute("max",e),this.$current.value=t,this.__updateProgressPosition(t),this.__updateBar(e),this.debug&&this.__updateBarRange(e),this.__updateScale(e)}template(t,e){let n="",i="",r="";for(let e=0;e<t.length;e++){let r=t[e];n+=`<div class="row" id="row-${e}"><div class="label" idx="${e}">${r.key}</div></div>`;let s="";this.debug&&(s=`\n          <input class="begin" type="range" min="0" max="0" step="10" value="${r.beginAt}">\n          <input class="end" type="range" min="0" max="0" step="10" value="${r.endAt}">\n        `),i+=`\n        <div class="row">\n          <div class="bar bar--${this.debug?"debug":"default"}" idx="${e}"></div>\n          ${s}\n        </div>`,this.debug}for(let t=0,n=Math.floor(e/1e3);t<n;t++)r+=`<div class="scale-label" style="--sec: ${t+1}">${t+1}s</div>`;return`\n      <style>\n        * {\n          box-sizing: border-box;\n        }\n        :host {\n          display: block;\n          height: 100%;\n        }\n        .container {\n          display: flex;\n          flex-direction: column;\n          height: 100%;\n          background-color: #313131;\n          color: #eeeeee;\n          position: relative;\n          --tools-height: 40px;\n          --controls-height: 40px;\n        }\n        .tools {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-shrink: 0;\n          height: var(--tools-height);\n          border-bottom: 1px solid #202020;\n        }\n        .tools__item {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          width: 20px;\n          margin: 0 8px;\n          color: #eeeeee;\n        }\n        .tools__item div {\n          width: 100%;\n          cursor: pointer;\n        }\n        .tools__item div:hover {\n          opacity: .6;\n        }\n        .tools__item svg {\n          fill: currentColor;\n        }\n        .controls {\n          display: flex;\n          flex-shrink: 0;\n          height: var(--controls-height);\n          border-bottom: 1px solid #202020;\n        }\n        .pane {\n          display: flex;\n          flex: 1;\n          overflow: scroll;\n          scroll-behavior: smooth;\n        }\n        .head {\n          flex-shrink: 0;\n          flex-basis: 20%;\n          max-width: 200px;\n          min-width: 0;\n        }\n        .body {\n          flex: 1;\n          position: relative;\n        }\n        .actions {\n          height: 100%;\n          border-right: 1px solid #222322;\n        }\n        .rows {\n          border-right: 1px solid #222322;\n        }\n        .row {\n          display: flex;\n          align-items: center;\n          height: 24px;\n          border-bottom: 1px solid #202020;\n          position: relative;\n        }\n        .row input[type="range"] {\n          position: absolute;\n          inset: 0;\n        }\n        .label {\n          padding-left: 12px;\n          font-size: 12px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n          cursor: pointer;\n        }\n        .bar {\n          height: 100%;\n          background-color: #545454;\n          opacity: .5;\n          transform-origin: left;\n          cursor: pointer;\n          position: relative;\n        }\n        .bar.bar--debug::before {\n          content: "";\n          display: block;\n          width: 6px;\n          position: absolute;\n          left: 0;\n          top: 0;\n          bottom: 0;\n          margin: 4px;\n          border-radius: 2px;\n          background-color: darkgray;\n        }\n        .bar.bar--debug::after {\n          content: "";\n          display: block;\n          width: 6px;\n          position: absolute;\n          right: 0;\n          top: 0;\n          bottom: 0;\n          margin: 4px;\n          border-radius: 2px;\n          background-color: darkgray;\n        }\n        .bar.bar--active {\n          opacity: 1;\n        }\n        .progress {\n          position: absolute;\n          top: var(--tools-height);\n          bottom: 0;\n          left: 0;\n          width: 2px;\n          margin-left: min(20%, 200px);\n          background-color: #71A0EB;\n          opacity: 0.6;\n        }\n        .progress::before {\n          content: "";\n          display: block;\n          width: 20px;\n          height: 30px;\n          background-color: #53aeff;\n          margin-left: -9px;\n        }\n        .progress::after {\n          content: "";\n          display: block;\n          border-top: 10px solid #53aeff;\n          border-left: 10px solid transparent;\n          border-right: 10px solid transparent;\n          margin-left: -9px;\n        }\n        .current {\n          position: absolute;\n          top: var(--tools-height);\n          height: var(--controls-height);\n          left: -12px;\n          right: -12px;\n          margin-left: min(20%, 200px);\n        }\n        input[type="range"] {\n          -webkit-appearance: none;\n          appearance: none;\n          margin: 0;\n          cursor: pointer;\n          outline: none;\n        }\n        input[type="range"]::-webkit-slider-thumb {\n          opacity: 0;\n        }\n        input[type="range"]::-moz-range-thumb {\n          opacity: 0;\n        }\n        /* Firefox„ÅßÁÇπÁ∑ö„ÅåÂë®„Çä„Å´Ë°®Á§∫„Åï„Çå„Å¶„Åó„Åæ„ÅÜÂïèÈ°å„ÅÆËß£Ê∂à */\n        input[type="range"]::-moz-focus-outer {\n          border: 0;\n        }\n        .current input[type="range"] {\n          height: var(--controls-height);\n          width: 100%;\n          background: transparent;\n        }\n        input.begin[type="range"],\n        input.end[type="range"] {\n          height: 100%;\n          width: calc(100% + 12px);\n          background: transparent;\n          pointer-events: none;\n          margin-left: -6px;\n        }\n        input.begin[type="range"]::-webkit-slider-thumb,\n        input.end[type="range"]::-webkit-slider-thumb {\n          -webkit-appearance: none;\n          appearance: none;\n          pointer-events: auto;\n          opacity: 0;   \n          width: 12px;\n          height: 100%;\n          cursor: ew-resize;\n        }\n        input.begin[type="range"]::-moz-range-thumb,\n        input.end[type="range"]::-moz-range-thumb {\n          -webkit-appearance: none;\n          appearance: none;\n          pointer-events: auto;\n          opacity: 0;   \n          width: 12px;\n          height: 100%;\n          cursor: ew-resize;\n        }\n        input.begin[type="range"]::-webkit-slider-thumb {\n          background: darkgreen;\n          transform: translateX(50%);\n        }\n        input.begin[type="range"]::-moz-range-thumb {\n          background: darkgreen;\n          transform: translateX(50%);\n        }\n        input.end[type="range"]::-webkit-slider-thumb {\n          background: indianred;\n          transform: translateX(-50%);\n        }\n        input.end[type="range"]::-moz-range-thumb {\n          background: indianred;\n          transform: translateX(-50%);\n        }\n        .scale {\n          position: relative;\n          height: 100%;\n        }\n        .scale-s,\n        .scale-100ms {\n          height: 50%;\n        }\n        .scale-s {\n          /*\n            total / 1s \n            e.g. 6000 / 1000\n            x / 1000 = 6\n            calc(100% / calc(var(--total) / 1000))\n           */\n          --x: calc(100% / calc(var(--total) / 1000));\n          background: repeating-linear-gradient(90deg, transparent 0, transparent calc(var(--x) - 1px), #202020 calc(var(--x) - 1px), #202020 var(--x));\n          border-bottom: 1px solid #202020;\n        }\n        .scale-100ms {\n          --x: calc(100% / calc(var(--total) / 1000) / 10);\n          background: repeating-linear-gradient(90deg, transparent 0, transparent calc(var(--x) - 1px), #202020 calc(var(--x) - 1px), #202020 var(--x));\n        }\n        .scale-label {\n          --x: calc(100% / calc(var(--total) / 1000));\n          position: absolute;\n          top: 0;\n          left: calc(var(--x) * var(--sec));\n          font-size: 10px;\n          font-style: italic;\n          transform: translateX(calc(-100% - 4px));\n        }\n      </style>\n      <div class="container">\n        <div class="tools">\n          <div class="tools__item">\n            <div id="previous">\n              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                <path d="M2.75 20C2.75 20.5523 3.19772 21 3.75 21C4.30228 21 4.75 20.5523 4.75 20L4.75 4C4.75 3.44772 4.30229 3 3.75 3C3.19772 3 2.75 3.44772 2.75 4V20Z"/>\n                <path d="M20.75 19.0526C20.75 20.4774 19.1383 21.305 17.9803 20.4748L7.51062 12.9682C6.50574 12.2477 6.54467 10.7407 7.5854 10.073L18.0551 3.35665C19.2198 2.60946 20.75 3.44583 20.75 4.82961L20.75 19.0526Z"/>\n              </svg>\n            </div>\n          </div>\n          <div class="tools__item">\n            <div id="play-pause">\n              <svg viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                \x3c!-- Generator: Sketch 59.1 (86144) - https://sketch.com --\x3e\n                <title>ic_fluent_video_play_pause_24_filled</title>\n                <desc>Created with Sketch.</desc>\n                <g id="üîç-Product-Icons" stroke="none" stroke-width="1" >\n                    <g id="ic_fluent_video_play_pause_24_filled" fill-rule="nonzero">\n                        <path d="M3.65140982,6.61646219 L11.1528787,11.3693959 C11.3672679,11.5052331 11.4827597,11.722675 11.4993749,11.9464385 L11.4984593,7.25 C11.4984593,6.83578644 11.8342458,6.5 12.2484593,6.5 L15.2484593,6.5 C15.6626729,6.5 15.9984593,6.83578644 15.9984593,7.25 L15.9984593,16.75 C15.9984593,17.1642136 15.6626729,17.5 15.2484593,17.5 L12.2484593,17.5 C11.8342458,17.5 11.4984593,17.1642136 11.4984593,16.75 L11.4993494,12.0597632 C11.4826318,12.2835468 11.3670166,12.5009613 11.1525249,12.6366956 L3.65105604,17.3837618 C3.15168144,17.6997752 2.5,17.3409648 2.5,16.75 L2.5,7.25 C2.5,6.65884683 3.15205264,6.30006928 3.65140982,6.61646219 Z M21.2477085,6.50037474 C21.661922,6.50037474 21.9977085,6.83616118 21.9977085,7.25037474 L21.9977085,16.7496253 C21.9977085,17.1638388 21.661922,17.4996253 21.2477085,17.4996253 L18.2477085,17.4996253 C17.8334949,17.4996253 17.4977085,17.1638388 17.4977085,16.7496253 L17.4977085,7.25037474 C17.4977085,6.83616118 17.8334949,6.50037474 18.2477085,6.50037474 L21.2477085,6.50037474 Z" id="üé®-Color"></path>\n                    </g>\n                </g>\n              </svg>\n            </div>\n          </div>\n          <div class="tools__item">\n            <div id="next">\n              <svg   viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                <path d="M21 4C21 3.44772 20.5523 3 20 3C19.4477 3 19 3.44772 19 4V20C19 20.5523 19.4477 21 20 21C20.5523 21 21 20.5523 21 20V4Z"/>\n                <path d="M3 4.94743C3 3.5226 4.61175 2.69498 5.7697 3.52521L16.2394 11.0318C17.2443 11.7523 17.2053 13.2593 16.1646 13.927L5.69492 20.6434C4.53019 21.3905 3 20.5542 3 19.1704V4.94743Z"/>\n              </svg>\n            </div>\n          </div>\n        </div>\n        <div class="controls">\n          <div class="head"><div class="actions"></div></div>\n          <div class="body">\n            <div class="scale" id="scale" style="--total: ${e}">\n              <div class="scale-s"></div>\n              <div class="scale-100ms"></div>\n              ${r}\n            </div>\n          </div>\n        </div>\n        <div id="pane" class="pane">\n          <div class="head">\n            <div class="rows">\n              ${n}\n            </div>\n          </div>\n          <div id="timeline" class="body">\n            <div class="rows">\n              ${i}\n            </div>\n          </div>\n        </div>\n        <div class="current">\n          <input id="current" type="range" min="0" max="0" step="any" value="0">\n        </div>\n        <div id="progress" class="progress"></div>\n      </div>\n    `}__updateScale(t){let e=this.shadowRoot.querySelector(".test");e&&e.remove(),this.shadowRoot.querySelectorAll(".scale-label").forEach((t=>{t.remove()})),this.shadowRoot.querySelector(".scale").style.setProperty("--total",t);let n="";for(let e=0,i=Math.floor(t/1e3);e<i;e++)n+=`<div class="scale-label" style="--sec: ${e+1}">${e+1}s</div>`;let i=document.createElement("div");i.className="test",i.innerHTML=n,this.shadowRoot.querySelector(".scale").appendChild(i)}__updateProgressPosition(t){let e=this.$timeline.clientWidth,n=Math.min(t/this.totalTime,1)*e;this.$progress.style.transform=`translateX(${n}px)`}__updateBarRange(t){for(let e=0;e<this.$bars.length;e++){let n=this.axes[e];this.$barsBegin[e].setAttribute("max",t),this.$barsBegin[e].value=n.beginAt,this.$barsEnd[e].setAttribute("max",t),this.$barsEnd[e].value=n.endAt}}__updateBar(t){let e=this.$timeline.clientWidth/t;for(let t=0;t<this.$bars.length;t++){let n=this.axes[t],i=n.beginAt*e,r=(n.endAt-n.beginAt)*e;this.$bars[t].style.transform=`translateX(${i}px)`,this.$bars[t].style.width=`${r}px`,0<n.progress&&!n.pass?this.$bars[t].classList.add("bar--active"):this.$bars[t].classList.remove("bar--active")}}};window.customElements.define("taxis-timeline",vt);var Et={key:"",beginAt:0,endAt:0,duration:0,delay:0,position:0,progress:0,enter:!1,pass:!1};const yt={bucketsCount:8};const _t=function(){const{subscribe:t,set:e,update:n}=H(yt);return{subscribe:t,reset:()=>e(yt),set:t=>e(t)}}(),Tt=128,wt=.5;let At=[-1.5,0,0],Rt=[1.5,0,0],Mt=[0,0,0];const kt=t=>{const e=new lt,n=new class{constructor(t={}){this.option=t,this.axes=[]}get totalTime(){return this.axes.length?Math.max(...this.axes.map((t=>t.endAt))):0}get totalTimeForTimeline(){return this.totalTime+500}get everyPassed(){return this.axes.every((t=>t.pass))}restart(){this.beginAt=Date.now()}getAxis({key:t}){return this.axes.find((e=>e.key===t))}getAxes(){return this.axes}add(t,e,n=0,i){let r=this.totalTime+n;if(void 0!==i)r=Number.isFinite(i)?i+n:this.getAxis({key:i}).endAt+n;else{let t=this.axes[this.axes.length-1];i=t?t.key:0}return this.axes.push({...Et,key:t,beginAt:r,endAt:r+e,duration:e,delay:n,position:i}),this.sort(),this}begin(){this.option.timeline&&(this.timeline=new vt(this.axes,this.totalTimeForTimeline,this.option.timeline.debug),this.option.timeline.container.appendChild(this.timeline)),this.beginAt=Date.now(),this.__tick()}reset(){cancelAnimationFrame(this.requestID)}ticker(t){this.tickerFn=t}__tick(){let t=this.beginAt,e=Date.now()-t,n=!1;if(this.option.timeline){this.axes=this.recalculation(this.timeline.getAxes());let{beginAt:i,elapsedTime:r,editing:s}=this.timeline.get(this.beginAt);t=i,e=r,n=s}this.beginAt=t,this.axes.forEach(((t,n)=>{let i=e-t.beginAt,r=Math.max(0,Math.min(i/t.duration,1)),s=t.beginAt<=e,a=t.endAt<e;t.progress=r,t.enter=s,t.pass=a})),this.option.timeline&&!n&&this.timeline.update(e,this.totalTimeForTimeline,this.axes),this.tickerFn&&this.tickerFn(e,this.toMap(this.axes)),this.requestID=requestAnimationFrame(this.__tick.bind(this))}calculation(){let t=[];for(let e=0;e<this.axes.length;e++){let n=this.axes[e],{key:i,duration:r,position:s,delay:a}=n,o=Math.max(...t.map((t=>t.endAt)))+a;void 0!==s?o=Number.isFinite(s)?s+a:this.getAxis({key:s}).endAt+a:s=o,t.push({...Et,key:i,beginAt:o,endAt:o+r,duration:r,delay:a,position:s})}}recalculation(t){let e=[];for(let n=0;n<t.length;n++){let i=t[n],{key:r,duration:s,position:a,delay:o}=i,l=Math.max(...e.map((t=>t.endAt)))+o;void 0!==a?l=Number.isFinite(a)?a+o:this.getAxis({key:a}).endAt+o:a=l,e.push({...Et,key:r,beginAt:l,endAt:l+s,duration:s,delay:o,position:a})}return e}sort(){this.axes.sort(((t,e)=>t.beginAt-e.beginAt))}toMap(t){let e=new Map;return t.forEach((t=>{e[t.key]=t,e.set(t.key,t)})),e}}({timeline:{container:document.querySelector("#timeline"),debug:!1}});n.add("Sampling",3e3);for(let t=0;t<o(_t).bucketsCount;t++)0===t?n.add(`split#${t}`,500,500):n.add(`split#${t}`,500);for(let t=0;t<o(_t).bucketsCount;t++)n.add(`Average color#${t}`,500);let i;n.add("Mapping",3e3,500);let r=[],s=0,a=-1;e.initialize(t);let l,c,u,h,d,p,g,m,f,b,x,v,E=null,y=null,_=[],T=[],w=[],A=[],R=[],M=[],k=[],P=[],L=[],$=[],B=[],C=[],S=[],U=[],I=null,D=null,F=null,N=null,X=null,O=null;const q={distance:7.5,min:1,max:20,move:2},V=new ct(t,q);function j(){e.width=window.innerWidth,e.height=window.innerHeight,window.innerWidth<window.innerHeight?(V.distance=1e3/window.innerHeight*q.distance,At=[0,1.5,0],Rt=[0,-1.5,0],Mt=[0,0,0]):(V.distance=900/window.innerWidth*q.distance,At=[-1.5,0,0],Rt=[1.5,0,0],Mt=[0,0,0])}function G(t){const n=e.gl;let i=ut.mat4.identity(ut.mat4.create());i=ut.mat4.translate(i,t);const r=ut.mat4.multiply(O,i);n.uniformMatrix4fv(I.mvpMatrix,!1,r)}function H(t){const n=e.gl;let i=ut.mat4.identity(ut.mat4.create());i=ut.mat4.translate(i,t),n.uniformMatrix4fv(D.mMatrix,!1,i);const r=ut.mat4.multiply(O,i);n.uniformMatrix4fv(D.mvpMatrix,!1,r)}e.width=window.innerWidth,e.height=window.innerHeight,j(),window.addEventListener("resize",j),window.Promise.resolve().then((t=>{t=o(Y).file;const n=document.createElement("canvas");n.width=Tt,n.height=Tt;const s=n.getContext("2d");s.drawImage(t,0,0,t.width,t.height,0,0,Tt,Tt),x=s.getImageData(0,0,n.width,n.height),i=new bt(x,{strict:!0}),v=i.reduce(o(_t).bucketsCount),r=i.bucketsPerStep,F=e.createTexture(t,e.gl.TEXTURE0),e.createTexture(v,e.gl.TEXTURE1)})).then((()=>window.Promise.all([lt.loadFile("./shader/main.vert"),lt.loadFile("./shader/main.frag"),lt.loadFile("./shader/sub.vert"),lt.loadFile("./shader/sub.frag")]))).then((t=>{const[i,q,j,z]=t,Y=e.createShaderObject(i,e.gl.VERTEX_SHADER),W=e.createShaderObject(q,e.gl.FRAGMENT_SHADER);E=e.createProgramObject(Y,W);const J=e.createShaderObject(j,e.gl.VERTEX_SHADER),K=e.createShaderObject(z,e.gl.FRAGMENT_SHADER);y=e.createProgramObject(J,K),e.program=E;const Q=e.gl;Q.enable(Q.DEPTH_TEST),Q.disable(Q.CULL_FACE),Q.enable(Q.BLEND),Q.blendFuncSeparate(Q.SRC_ALPHA,Q.ONE_MINUS_SRC_ALPHA,Q.ONE,Q.ONE),l=mt.plane(1,1,0,[1,.1,0,1]),c=[e.createVBO(l.position),e.createVBO(l.color),e.createVBO(l.texCoord)],u=e.createIBO(l.index),h=mt.plane(1,1,0,[1,.1,0,1]),e.createVBO(h.position),e.createVBO(h.color),e.createVBO(h.texCoord),e.createIBO(h.index),function(){const t=x.data.length/4;for(let e=0;e<t;e++){const t=x.data[4*e],n=x.data[4*e+1],i=x.data[4*e+2],r=x.data[4*e+3],s=e,a=s%x.width,o=Math.floor(s/x.width);k.push(a/Tt-wt+At[0],-1*(o/Tt-wt)+At[1],At[2]),P.push(t/255-wt+Mt[0],n/255-wt+Mt[1],i/255-wt+Mt[2]),L.push(t/255,n/255,i/255,r/255)}$=[e.createVBO(k),e.createVBO(P),e.createVBO(L)]}(),function(){const t=x.data.length/4;for(let e=0;e<t;e++){const t=x.data[4*e],n=x.data[4*e+1],i=x.data[4*e+2];x.data[4*e+3];const r=e,s=r%x.width,a=Math.floor(r/x.width);B.push(t/255-wt+Mt[0],n/255-wt+Mt[1],i/255-wt+Mt[2]),C.push(s/Tt-wt+Rt[0],-1*(a/Tt-wt)+Rt[1],Rt[2]);const o=v.data[4*e],l=v.data[4*e+1],c=v.data[4*e+2],u=v.data[4*e+3];S.push(o/255,l/255,c/255,u/255)}U=[e.createVBO(B),e.createVBO(C),e.createVBO(S)]}(),r.forEach(((t,n)=>{_[n]=[],T[n]=[],w[n]=[],A[n]=[],R[n]=[],M[n]=[],t.forEach(((t,i)=>{const{total:s,colors:a,channel:o,minR:l,minG:c,minB:u,maxR:h,maxG:d,maxB:p}=r[n][i],g=(h-l)/255,m=(d-c)/255,f=(p-u)/255,b=bt.averageColor(a),x=mt.box(g,m,f,[b[0]/255,b[1]/255,b[2]/255,.8]),v=mt.boxLine(g,m,f,[.65,.65,.65,1]);R[n][i]=v,M[n][i]=[e.createVBO(v.position),e.createVBO(v.color)],_[n][i]=x,T[n][i]=[l/255-(1-g)/2,c/255-(1-m)/2,u/255-(1-f)/2],w[n][i]=[e.createVBO(x.position),e.createVBO(x.color)],A[n][i]=e.createIBO(x.index)}))})),d=mt.axis(10,[.45,.45,.45,1]),p=[e.createVBO(d.position),e.createVBO(d.color)],function(){const t=e.gl;e.program=E,g=[t.getAttribLocation(e.program,"position"),t.getAttribLocation(e.program,"color"),t.getAttribLocation(e.program,"texCoord")],m=[3,4,2],I={mvpMatrix:t.getUniformLocation(e.program,"mvpMatrix"),textureUnit:t.getUniformLocation(e.program,"textureUnit"),isTexture:t.getUniformLocation(e.program,"isTexture")}}(),function(){const t=e.gl;e.program=y,f=[t.getAttribLocation(e.program,"fromPosition"),t.getAttribLocation(e.program,"toPosition"),t.getAttribLocation(e.program,"color")],b=[3,3,4],D={mMatrix:t.getUniformLocation(e.program,"mMatrix"),mvpMatrix:t.getUniformLocation(e.program,"mvpMatrix"),interporation:t.getUniformLocation(e.program,"interporation"),eyePosition:t.getUniformLocation(e.program,"eyePosition")}}(),n.begin(),function(){const t=e.gl;n.ticker(((i,r)=>{let h=0;r.get("Sampling").pass&&(h=1),r.get("split#7").pass&&(h=2),r.get("Average color#7").pass&&(h=3);for(let t=0;t<o(_t).bucketsCount;t++)r.get(`split#${t}`).enter&&s<t&&(s=t),r.get(`Average color#${t}`).enter&&a<t&&(a=t),r.get(`split#${t}`).progress<=0&&t<=s&&(s=t-1),r.get(`Average color#${t}`).progress<=0&&t<=a&&(a=t-1);Z.update(h),function(){const t=e.gl;t.viewport(0,0,e.width,e.height),t.clearColor(.1,.12,.14,1),t.clear(t.COLOR_BUFFER_BIT),N=V.update();const n=45,i=e.width/e.height,r=.1,s=20;X=ut.mat4.perspective(n,i,r,s),O=ut.mat4.multiply(X,N)}(),e.program=y,t.uniform3fv(D.eyePosition,V.position),function(t){const i=e.gl,r=n.getAxis({key:"Sampling"});i.uniform1f(D.interporation,r.progress),e.enableAttribute($,f,b),H(t),i.drawArrays(i.POINTS,0,P.length/3)}([0,0,0]),function(t){const i=e.gl,r=n.getAxis({key:"Mapping"});if(0===r.progress)return;i.uniform1f(D.interporation,r.progress),e.enableAttribute(U,f,b),H(t),i.drawArrays(i.POINTS,0,C.length/3)}([0,0,0]),e.program=E,function(){const t=e.gl;t.uniform1i(I.isTexture,0),t.disableVertexAttribArray(g[2]),e.enableAttribute(p,g,m),G([0,0,0]),t.drawArrays(t.LINES,0,d.position.length/3)}(),function(t){const n=e.gl;e.enableAttribute(c,g,m),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,u),n.activeTexture(e.gl.TEXTURE0),n.bindTexture(e.gl.TEXTURE_2D,F),n.uniform1i(I.textureUnit,0),n.uniform1i(I.isTexture,1),n.enableVertexAttribArray(g[2]),G(t),n.drawElements(n.TRIANGLES,l.index.length,n.UNSIGNED_SHORT,0)}(At),r.get("split#0").enter&&(function(t){const n=e.gl;n.disableVertexAttribArray(g[2]),n.uniform1i(I.isTexture,0);for(let i=0;i<_[s].length;i++){e.enableAttribute(M[s][i],g,m);G([t[0]+T[s][i][0],t[1]+T[s][i][1],t[2]+T[s][i][2]]),n.drawArrays(n.LINES,0,R[s][i].position.length/3)}}(Mt),-1<a&&function(t){const n=e.gl;n.disableVertexAttribArray(g[2]),n.uniform1i(I.isTexture,0);const i=_.length-1;for(let r=0;r<=a;r++){e.enableAttribute(w[i][r],g,m),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,A[i][r]);G([t[0]+T[i][r][0],t[1]+T[i][r][1],t[2]+T[i][r][2]]),n.drawElements(n.TRIANGLES,_[i][r].index.length,n.UNSIGNED_SHORT,0)}}(Mt))}))}()}))};function Pt(e){let n;return{c(){n=g("canvas"),x(n,"class","w-full h-full")},m(t,i){h(t,n,i),e[1](n)},p:t,i:t,o:t,d(t){t&&d(n),e[1](null)}}}function Lt(t,e,n){let i;return T((()=>{kt(i)})),[i,function(t){A[t?"unshift":"push"]((()=>{i=t,n(0,i)}))}]}class $t extends j{constructor(t){super(),V(this,t,Lt,Pt,s,{})}}function Bt(e){let n,r,s,a,o,l,c,p,m,v,E,y,_,T,w,A,R,M,k,P,L,$,B,C,S,U,I,D,F,N,X,O,q,V,j,G,H;return{c(){n=g("div"),r=g("div"),r.innerHTML='<div class="w-full h-full"><div id="upload-area" class="h-full flex flex-col justify-center relative shadow-lg sm:overflow-hidden"><div class="absolute inset-0"><div class="h-full w-full bg-gray-100"></div></div> \n        <div class="relative px-4 py-16 sm:px-6 sm:py-24 lg:py-32 lg:px-8"><h1 class="text-center text-4xl font-extrabold tracking-tight sm:text-5xl lg:text-6xl"><span class="block text-gray-800">Visualize color reduction</span> \n            <span class="block text-gray-500">Any image you like.</span></h1> \n          <p class="mt-6 max-w-lg mx-auto text-center text-xl text-gray-500 sm:max-w-4xl">The logic of color reduction is difficult.\n            I hope that visualizing it will help you understand it.\n            Implemented with reference to Median cut.\n            It is implemented using webgl.<br/>\n            Sorry, maybe only chrome is supported.</p> \n\n          <div id="upload" class="px-4 py-8 sm:px-0"><form action=""><div class="sm:mt-0 sm:col-span-2"><div class="text-center"><svg class="mx-auto h-12 w-12 text-gray-500" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg> \n                  <p class="mt-1 text-sm text-gray-500"><label id="original-image-label" for="original-image-file" class="cursor-pointer font-medium text-pink-600 hover:text-pink-500 focus:outline-none focus:underline transition duration-150 ease-in-out">Upload a file\n                      <input type="file" id="original-image-file" class="hidden"/></label>\n                    or drag and drop</p> \n                  <p class="mt-1 text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p></div></div></form></div></div></div></div>',s=f(),a=g("div"),o=g("div"),l=g("p"),l.textContent="Or try one of these:",c=f(),p=g("div"),m=g("div"),v=g("img"),y=f(),_=g("span"),_.innerHTML='Photo by <a href="https://unsplash.com/@vincentledvina?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Vincent Ledvina</a>\n            on\n            <a href="https://unsplash.com/s/visual/4050ed5c-59f1-4b72-965f-8d82efcfbc94?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a>',T=f(),w=g("div"),A=g("img"),M=f(),k=g("span"),k.innerHTML='Photo by <a href="https://unsplash.com/@greysonjoralemon?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Greyson Joralemon</a>\n            on\n            <a href="https://unsplash.com/s/photos/colorful?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a>',P=f(),L=g("div"),$=g("img"),C=f(),S=g("span"),S.innerHTML='Photo by <a href="https://unsplash.com/@jezael?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Jezael Melgoza</a>\n            on\n            <a href="https://unsplash.com/s/photos/japan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a>',U=f(),I=g("div"),D=g("img"),N=f(),X=g("span"),X.innerHTML='Photo by <a href="https://unsplash.com/@jannerboy62?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Nick Fewings</a>\n            on\n            <a href="https://unsplash.com/s/photos/red?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a>',O=f(),q=g("div"),V=g("img"),x(r,"class","relative flex-grow"),x(l,"class","text-center text-sm font-semibold uppercase text-gray-500 tracking-wide"),v.src!==(E="./assets/bison.jpg")&&x(v,"src","./assets/bison.jpg"),x(v,"alt",""),x(v,"class","cursor-pointer"),x(m,"class","col-span-1 flex flex-col justify-start md:col-span-2 lg:col-span-1"),A.src!==(R="./assets/colorful.jpg")&&x(A,"src","./assets/colorful.jpg"),x(A,"alt",""),x(A,"class","cursor-pointer"),x(w,"class","col-span-1 flex flex-col justify-start md:col-span-2 lg:col-span-1"),$.src!==(B="./assets/shibuya.jpg")&&x($,"src","./assets/shibuya.jpg"),x($,"alt",""),x($,"class","cursor-pointer"),x(L,"class","col-span-1 flex flex-col justify-start md:col-span-2 lg:col-span-1"),D.src!==(F="./assets/telephone_booth.jpg")&&x(D,"src","./assets/telephone_booth.jpg"),x(D,"alt",""),x(D,"class","cursor-pointer"),x(I,"class","col-span-1 flex flex-col justify-start md:col-span-2 lg:col-span-1"),V.src!==(j="./assets/pineapple.jpg")&&x(V,"src","./assets/pineapple.jpg"),x(V,"alt",""),x(V,"class","cursor-pointer"),x(q,"class","col-span-1 flex flex-col justify-start md:col-span-2 lg:col-span-1"),x(p,"class","mt-6 grid grid-cols-2 gap-8 md:grid-cols-6 lg:grid-cols-5"),x(o,"class","max-w-7xl mx-auto py-16 px-4 sm:px-6 lg:px-8"),x(a,"class","bg-gray-100"),x(n,"class","h-full flex flex-col")},m(t,i){h(t,n,i),u(n,r),u(n,s),u(n,a),u(a,o),u(o,l),u(o,c),u(o,p),u(p,m),u(m,v),u(m,y),u(m,_),u(p,T),u(p,w),u(w,A),u(w,M),u(w,k),u(p,P),u(p,L),u(L,$),u(L,C),u(L,S),u(p,U),u(p,I),u(I,D),u(I,N),u(I,X),u(p,O),u(p,q),u(q,V),G||(H=[b(v,"click",e[0]),b(A,"click",e[0]),b($,"click",e[0]),b(D,"click",e[0]),b(V,"click",e[0])],G=!0)},p:t,i:t,o:t,d(t){t&&d(n),G=!1,i(H)}}}function Ct(t,e,n){let i;l(t,Y,(t=>n(1,i=t))),T((()=>{const t=document.getElementById("upload-area");t.addEventListener("change",(t=>{e({e:t,data:void 0,callback:t=>{c(Y,i.file=t,i)}})})),t.addEventListener("drop",(t=>{t.preventDefault(),e({e:t,data:t.dataTransfer.files[0],callback:t=>{c(Y,i.file=t,i)}})})),t.addEventListener("dragenter",(t=>{t.preventDefault()})),t.addEventListener("dragover",(t=>{t.preventDefault()})),t.addEventListener("dragleave",(t=>{t.preventDefault()}));const e=({e:t,data:e,callback:n})=>{let i=void 0===e?t.target.files[0]:e;if(!i.type.match(/^image\/(png|jpg|jpeg|gif)$/))return;if(10485760<=i.size)return;let r=new Image,s=new FileReader;s.onload=t=>{let e=t.target.result;r.onload=()=>{n(r)},r.src=e},s.readAsDataURL(i)}}));return[t=>{c(Y,i.file=t.currentTarget,i)}]}class St extends j{constructor(t){super(),V(this,t,Ct,Bt,s,{})}}function Ut(e){let n,i,r,s,a,o,l,c,u,p,m;return n=new $t({props:{class:"w-full h-full"}}),s=new ot({}),{c(){N(n.$$.fragment),i=f(),r=g("div"),N(s.$$.fragment),a=f(),o=g("div"),o.innerHTML='<div id="timeline" class="h-full"></div>',l=f(),c=g("div"),c.innerHTML='<svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-8 text-gray-800"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',x(r,"class","fixed right-8 top-8 hidden md:block"),x(o,"class","fixed left-0 right-0 bottom-0 h-1/5"),x(c,"class","fixed left-8 top-8 bg-gray-100 p-2 cursor-pointer rounded-full")},m(t,d){X(n,t,d),h(t,i,d),h(t,r,d),X(s,r,null),h(t,a,d),h(t,o,d),h(t,l,d),h(t,c,d),u=!0,p||(m=b(c,"click",e[1]),p=!0)},p:t,i(t){u||(D(n.$$.fragment,t),D(s.$$.fragment,t),u=!0)},o(t){F(n.$$.fragment,t),F(s.$$.fragment,t),u=!1},d(t){O(n,t),t&&d(i),t&&d(r),O(s),t&&d(a),t&&d(o),t&&d(l),t&&d(c),p=!1,m()}}}function It(e){let n,i;return n=new St({}),{c(){N(n.$$.fragment)},m(t,e){X(n,t,e),i=!0},p:t,i(t){i||(D(n.$$.fragment,t),i=!0)},o(t){F(n.$$.fragment,t),i=!1},d(t){O(n,t)}}}function Dt(t){let e,n,r,s;const a=[It,Ut],o=[];function l(t,e){return t[0].file?1:0}return n=l(t),r=o[n]=a[n](t),{c(){e=g("main"),r.c(),x(e,"class","w-full h-full")},m(t,i){h(t,e,i),o[n].m(e,null),s=!0},p(t,[s]){let c=n;n=l(t),n===c?o[n].p(t,s):(I={r:0,c:[],p:I},F(o[c],1,1,(()=>{o[c]=null})),I.r||i(I.c),I=I.p,r=o[n],r?r.p(t,s):(r=o[n]=a[n](t),r.c()),D(r,1),r.m(e,null))},i(t){s||(D(r),s=!0)},o(t){F(r),s=!1},d(t){t&&d(e),o[n].d()}}}function Ft(t,e,n){let i;l(t,Y,(t=>n(0,i=t)));return[i,()=>{c(Y,i.file=null,i)}]}return new class extends j{constructor(t){super(),V(this,t,Ft,Dt,s,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
